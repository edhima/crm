import{a as x,d as I,o as c,c as h,b as g,t as B,u as n,_ as k,e as $,F as A,r as H,f as C,V as D,g as F,p as ce,m as me,h as pe,i as ve,j as _e,k as fe,l as be,n as ge,q as he,s as te,v as p,w as j,x as _,y as V,z as L,A as ye,B as se,C as we,D as ne,E as Ve,G as Ce,H as le,I as xe,J as Ie,K as oe,M as ie,L as R,N as re,O as ue,P as ke,Q as Se,R as Be,S as $e,T as Ue}from"./index.b477d4b7.js";import{V as Ee}from"./VAutocomplete.c05ee9d5.js";import{m as Fe,V as ae}from"./VSelect.b74e084b.js";const{Axios:It,AxiosError:Le,CanceledError:kt,isCancel:St,CancelToken:Bt,VERSION:$t,all:Ut,Cancel:Et,isAxiosError:Ft,spread:Lt,toFormData:At,AxiosHeaders:Dt,HttpStatusCode:Pt,formToJSON:Nt,getAdapter:Mt,mergeConfig:Tt}=x,Ae={class:"install-view-license"},De={class:"install-view-license-content"},Pe=I({__name:"InstallViewLicense",setup(d,{expose:o}){const e=U();return o({nextBtn:{label:"Accept"}}),(l,i)=>(c(),h("div",Ae,[g("div",De,B(n(e).license),1)]))}});const Ne=k(Pe,[["__scopeId","data-v-003a4ede"]]),Me={class:"install-view-environment"},Te={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},qe={class:"install-view-environment-item-title"},ze={key:0,class:"install-view-environment-item-message"},Oe=I({__name:"InstallViewEnvironment",setup(d,{expose:o}){const e=U(),l=$(()=>e.environment&&Object.values(e.environment).every(t=>t.status===1)),i=$(()=>l.value?"Next":"Recheck");return o({nextBtn:{label:i,action:()=>{l.value?e.nextStep():e.recheckEnvironment()}}}),(t,a)=>(c(),h("div",Me,[(c(!0),h(A,null,H(n(e).environment,(s,r)=>(c(),h("div",{key:r,class:"install-view-environment-item"},[s.status===1?(c(),C(D,{key:0,icon:"mdi-check-circle",color:"#097c31",size:"20"})):(c(),C(D,{key:1,icon:"mdi-close-circle",color:"#ac0221",size:"20"})),g("div",Te,[g("span",qe,B(s.label),1),s.message?(c(),h("span",ze,B(s.message),1)):F("",!0)])]))),128))]))}});const je=k(Oe,[["__scopeId","data-v-2e0b9228"]]);const Re=ce({...me(),...pe(Fe(),["inline"])},"VCheckbox"),He=ve()({name:"VCheckbox",inheritAttrs:!1,props:Re(),emits:{"update:modelValue":d=>!0,"update:focused":d=>!0},setup(d,o){let{attrs:e,slots:l}=o;const i=_e(d,"modelValue"),{isFocused:t,focus:a,blur:s}=fe(d),r=be(),u=$(()=>d.id||`checkbox-${r}`);return ge(()=>{const[f,m]=he(e),[y,G]=te.filterProps(d),[N,J]=ae.filterProps(d);return p(te,j({class:["v-checkbox",d.class]},f,y,{modelValue:i.value,"onUpdate:modelValue":E=>i.value=E,id:u.value,focused:t.value,style:d.style}),{...l,default:E=>{let{id:M,messagesId:T,isDisabled:q,isReadonly:z}=E;return p(ae,j(N,{id:M.value,"aria-describedby":T.value,disabled:q.value,readonly:z.value},m,{modelValue:i.value,"onUpdate:modelValue":O=>i.value=O,onFocus:a,onBlur:s}),l)}})}),{}}}),Ge={class:"install-view-database-config"},Je=I({__name:"InstallViewDatabaseConfig",setup(d,{expose:o}){const e=U(),l=_({dbname:"",host:"",port:"",username:""});return o({nextBtn:{action:async()=>{await e.validateDb()&&e.nextStep()}},validate:()=>{var t,a,s;l.value={dbname:"",host:"",port:"",username:""};let i=!0;return(t=e.databaseConfig.dbname)!=null&&t.trim()||(l.value.dbname="Field is required",i=!1),(a=e.databaseConfig.host)!=null&&a.trim()||(l.value.host="Field is required",i=!1),e.databaseConfig.port||(l.value.port="Field is required",i=!1),(s=e.databaseConfig.username)!=null&&s.trim()||(l.value.username="Field is required",i=!1),i}}),(i,t)=>(c(),h("div",Ge,[p(V,{modelValue:n(e).databaseConfig.dbname,"onUpdate:modelValue":t[0]||(t[0]=a=>n(e).databaseConfig.dbname=a),label:"Database name",variant:"outlined",density:"comfortable","error-messages":l.value.dbname,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.host,"onUpdate:modelValue":t[1]||(t[1]=a=>n(e).databaseConfig.host=a),label:"Database host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.port,"onUpdate:modelValue":t[2]||(t[2]=a=>n(e).databaseConfig.port=a),label:"Database port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.username,"onUpdate:modelValue":t[3]||(t[3]=a=>n(e).databaseConfig.username=a),label:"Username",variant:"outlined",density:"comfortable","error-messages":l.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.password,"onUpdate:modelValue":t[4]||(t[4]=a=>n(e).databaseConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":"auto"},null,8,["modelValue"]),p(Ee,{modelValue:n(e).databaseConfig.collation,"onUpdate:modelValue":t[5]||(t[5]=a=>n(e).databaseConfig.collation=a),items:n(P).db_collations,label:"Database collation",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","items"])]))}});const Ke=k(Je,[["__scopeId","data-v-ad266246"]]),Qe={class:"install-view-elastic-config"},We=I({__name:"InstallViewElasticConfig",setup(d,{expose:o}){const e=U(),l=_({host:"",port:""});return o({nextBtn:{action:async()=>{await e.validateElastic()&&e.nextStep()}},validate:()=>{var t;l.value={host:"",port:""};let i=!0;return(t=e.elasticConfig.host)!=null&&t.trim()||(l.value.host="Field is required",i=!1),e.elasticConfig.port||(l.value.port="Field is required",i=!1),i}}),(i,t)=>(c(),h("div",Qe,[p(V,{modelValue:n(e).elasticConfig.host,"onUpdate:modelValue":t[0]||(t[0]=a=>n(e).elasticConfig.host=a),label:"Elastic host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).elasticConfig.port,"onUpdate:modelValue":t[1]||(t[1]=a=>n(e).elasticConfig.port=a),label:"Elastic port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).elasticConfig.username,"onUpdate:modelValue":t[2]||(t[2]=a=>n(e).elasticConfig.username=a),label:"Username (optional)",variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"]),p(V,{modelValue:n(e).elasticConfig.password,"onUpdate:modelValue":t[3]||(t[3]=a=>n(e).elasticConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":""},null,8,["modelValue"])]))}});const Xe=k(We,[["__scopeId","data-v-b23c13ce"]]),Ye={class:"install-view-site-config"},Ze={class:"install-view-dummy-data"},et={class:"install-view-dummy-data-help"},tt=I({__name:"InstallViewSiteConfig",setup(d,{expose:o}){const e=U(),l=_(!1),i=_({url:"",username:"",password:""});return o({validate:()=>{var a,s,r;i.value={url:"",username:"",password:""};let t=!0;return(a=e.siteConfig.url)!=null&&a.trim()||(i.value.url="Field is required",t=!1),(s=e.siteConfig.username)!=null&&s.trim()||(i.value.username="Field is required",t=!1),(r=e.siteConfig.password)!=null&&r.trim()||(i.value.password="Field is required",t=!1),t}}),(t,a)=>(c(),h("div",Ye,[p(V,{modelValue:n(e).siteConfig.url,"onUpdate:modelValue":a[0]||(a[0]=s=>n(e).siteConfig.url=s),label:"Site URL",variant:"outlined",density:"comfortable","error-messages":i.value.url,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).siteConfig.username,"onUpdate:modelValue":a[1]||(a[1]=s=>n(e).siteConfig.username=s),label:"Admin username",variant:"outlined",density:"comfortable","error-messages":i.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).siteConfig.password,"onUpdate:modelValue":a[2]||(a[2]=s=>n(e).siteConfig.password=s),type:l.value?"text":"password",label:"Admin password",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","append-inner-icon":l.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":a[3]||(a[3]=s=>l.value=!l.value),"error-messages":i.value.password,"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon","error-messages"]),g("div",Ze,[p(He,{modelValue:n(e).siteConfig.demodata,"onUpdate:modelValue":a[4]||(a[4]=s=>n(e).siteConfig.demodata=s),color:"secondary",label:"Import dummy data","hide-details":""},null,8,["modelValue"]),p(ye,{location:"top start",text:"A set of dummy records will be installed on your system for demonstration purposes."},{activator:L(({props:s})=>[g("div",et,[p(D,j(s,{icon:"mdi-help",size:"14",color:"white"}),null,16)])]),_:1})])]))}});const at=k(tt,[["__scopeId","data-v-db6eb85a"]]),st={class:"install-view-installation"},nt={class:"installation-step-label"},lt=I({__name:"InstallViewInstallation",setup(d,{expose:o}){const e=U(),l=_({}),i=_(null),t=_(null);o({prevBtn:!1,nextBtn:!1}),se(async()=>{e.install(),await a(),t.value=setInterval(async()=>{await a()},1e3)}),we(()=>{t.value&&clearInterval(t.value)});async function a(){var r;try{const u=await x.get("api/install/status");Object.keys(u.data||{}).length!==Object.keys(l.value).length&&(l.value=u.data||{})}catch(u){u instanceof Le&&((r=u.response)==null?void 0:r.status)===404&&(e.isInstallationCompleted=!0)}}const s=$(()=>{var r;return Object.keys((r=l.value)!=null?r:{}).length?Object.keys(l.value).map(u=>parseInt(u)).sort((u,f)=>u<f?1:u>f?-1:0)[0]:0});return ne(()=>l.value,async()=>{var r;await Ve(),(r=i.value)==null||r.scrollTo({behavior:"smooth",left:0,top:i.value.scrollHeight})}),(r,u)=>(c(),h("div",st,[p(Ce,{color:"primary",stream:"","rounded-bar":"",rounded:"",height:"6",style:{"min-height":"6px"},"model-value":s.value,max:21},null,8,["model-value"]),g("div",{class:"install-view-installation-steps",ref_key:"stepsContainer",ref:i},[(c(!0),h(A,null,H(l.value,(f,m)=>(c(),h("div",{key:m,class:"install-view-installation-step"},[parseInt(m)===s.value?(c(),C(le,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",style:{overflow:"hidden"}})):(c(),C(D,{key:1,icon:"mdi-check-circle",color:"#097c31",size:"20"})),g("span",nt,B(f.replaceAll("_"," ")),1)]))),128))],512)]))}});const ot=k(lt,[["__scopeId","data-v-d205172a"]]),P={steps:[{title:"License",component:Ne},{title:"System Environment Check",component:je},{title:"Database configuration",component:Ke},{title:"ElasticSearch configuration",component:Xe},{title:"Site configuration",component:at},{title:"Installation",component:ot}],db_collations:["utf8mb4_general_ci","utf8mb4_bin","utf8mb4_unicode_ci","utf8mb4_icelandic_ci","utf8mb4_latvian_ci","utf8mb4_romanian_ci","utf8mb4_slovenian_ci","utf8mb4_polish_ci","utf8mb4_estonian_ci","utf8mb4_spanish_ci","utf8mb4_swedish_ci","utf8mb4_turkish_ci","utf8mb4_czech_ci","utf8mb4_danish_ci","utf8mb4_lithuanian_ci","utf8mb4_slovak_ci","utf8mb4_spanish2_ci","utf8mb4_roman_ci","utf8mb4_persian_ci","utf8mb4_esperanto_ci","utf8mb4_hungarian_ci","utf8mb4_sinhala_ci","utf8mb4_german2_ci","utf8mb4_croatian_ci","utf8mb4_unicode_520_ci","utf8mb4_vietnamese_ci"]},U=xe("install-view",()=>{const d=Ie(),o=_(!1),e=_(!1),l=_(!1),i=_(""),t=_(null),a=_(null),s=_(!1),r=_({dbname:"minthcm",host:"localhost",port:3306,username:"root",password:"",collation:"utf8mb4_general_ci"}),u=_({host:"localhost",port:9200,username:"",password:""}),f=_({url:window.location.href.split("#")[0],username:"admin",password:"",demodata:!1}),m=_(""),y=_(0),G=$(()=>P.steps[y.value]);async function N(){var b,w,v,K,Q,W,X,Y,Z,ee;e.value=!0;try{const S=await x.get("api/install/init");i.value=(w=(b=S.data)==null?void 0:b.version)!=null?w:"",t.value=(K=(v=S.data)==null?void 0:v.license)!=null?K:"",a.value=(W=(Q=S.data)==null?void 0:Q.environment)!=null?W:"",s.value=(Y=(X=S.data)==null?void 0:X.isInstalling)!=null?Y:!1,e.value=!1,(Z=S.data)!=null&&Z.isInstalling&&(y.value=P.steps.length-1)}catch(S){((ee=S.response)==null?void 0:ee.status)===404&&d.push({name:"dashboard"})}}async function J(){var w,v;const b=await x.get("api/install/license");t.value=(v=(w=b.data)==null?void 0:w.license)!=null?v:""}async function E(){o.value=!0;const b=await x.get("api/install/init");b.data.environment&&(a.value=b.data.environment),o.value=!1}async function M(){var b,w;o.value=!0;try{const v=await x.post("api/install/validate_db",r.value);return o.value=!1,((b=v.data)==null?void 0:b.status)===0?(m.value=v.data.message,console.error((w=v.data.error)!=null?w:v.data.message),!1):!0}catch(v){return console.error(v),m.value="Server error",o.value=!1,!1}}async function T(){var b,w;o.value=!0;try{const v=await x.post("api/install/validate_elastic",u.value);return o.value=!1,((b=v.data)==null?void 0:b.status)===0?(m.value=v.data.message,console.error((w=v.data.error)!=null?w:v.data.message),!1):!0}catch(v){return console.error(v),m.value="Server error",o.value=!1,!1}}async function q(){var w,v;if(s.value==!0)return!0;const b=await x.post("api/install/submit",{db:r.value,elastic:u.value,site:f.value});return((w=b.data)==null?void 0:w.status)===0?(m.value=b.data.message,console.error((v=b.data.error)!=null?v:b.data.message),!1):(l.value=!0,!0)}function z(){y.value--}function O(){y.value++}return ne(()=>y.value,()=>m.value=""),{currentStepNumber:y,currentStep:G,isInitialLoading:e,isLoading:o,isInstallationCompleted:l,version:i,license:t,environment:a,databaseConfig:r,elasticConfig:u,siteConfig:f,errorMsg:m,prevStep:z,nextStep:O,fetchLicense:J,recheckEnvironment:E,fetchInitialData:N,validateDb:M,validateElastic:T,install:q}}),it=d=>(re("data-v-bef3d2ea"),d=d(),ue(),d),rt={class:"install-view-completed"},ut=it(()=>g("h1",null,"Finished",-1)),dt=I({__name:"InstallViewCompleted",setup(d){function o(){location.reload()}return(e,l)=>(c(),h("div",rt,[ut,p(ie,{type:"success"},{default:L(()=>[oe(" Your MintHCM installation is ready. Go ahead and log-in as an administrator. ")]),_:1}),p(R,{variant:"primary",text:"Go to login",style:{width:"100%"},onClick:o})]))}});const ct=k(dt,[["__scopeId","data-v-bef3d2ea"]]),de=d=>(re("data-v-be1a25ad"),d=d(),ue(),d),mt={key:1,class:"install-view"},pt={class:"install-view-title"},vt=de(()=>g("h1",null,"MintHCM Setup Wizard",-1)),_t={class:"install-view-container"},ft={key:0,class:"install-view-loader"},bt={class:"install-view-container-title"},gt={class:"install-view-buttons"},ht={class:"install-view-footer"},yt=de(()=>g("div",{class:"install-view-footer"},[g("a",{href:"https://minthcm.org",target:"_blank"}," www.minthcm.org ")],-1)),wt=I({__name:"InstallView",setup(d){const o=U(),e=_(null),l=$(()=>{var s,r,u,f,m,y;return typeof((r=(s=e.value)==null?void 0:s.prevBtn)==null?void 0:r.label)=="string"?e.value.prevBtn.label:((f=(u=e.value)==null?void 0:u.prevBtn)==null?void 0:f.label)&&typeof((y=(m=e.value)==null?void 0:m.prevBtn)==null?void 0:y.label)=="object"?e.value.prevBtn.label.value:"Back"}),i=$(()=>{var s,r,u,f,m,y;return typeof((r=(s=e.value)==null?void 0:s.nextBtn)==null?void 0:r.label)=="string"?e.value.nextBtn.label:((f=(u=e.value)==null?void 0:u.nextBtn)==null?void 0:f.label)&&typeof((y=(m=e.value)==null?void 0:m.nextBtn)==null?void 0:y.label)=="object"?e.value.nextBtn.label.value:"Next"});se(()=>{o.fetchInitialData()});function t(){var s,r;((s=e.value)==null?void 0:s.prevBtn)&&typeof e.value.prevBtn.action=="function"?(r=e.value)==null||r.prevBtn.action():o.prevStep()}function a(){var s,r,u;typeof((s=e.value)==null?void 0:s.validate)=="function"&&!e.value.validate()||(((r=e.value)==null?void 0:r.nextBtn)&&typeof e.value.nextBtn.action=="function"?(u=e.value)==null||u.nextBtn.action():o.nextStep())}return(s,r)=>{var u,f;return n(o).isInitialLoading?(c(),C(Be,{key:0})):(c(),h("div",mt,[g("div",pt,[vt,g("span",null,"Version "+B(n(o).version),1)]),g("div",_t,[n(o).isInstallationCompleted?(c(),C(ct,{key:0})):(c(),h(A,{key:1},[p(ke,null,{default:L(()=>[n(o).isLoading?(c(),h("div",ft,[p(le,{indeterminate:"",color:"primary",size:"64"})])):F("",!0)]),_:1}),g("div",bt,B(n(o).currentStep.title),1),n(o).errorMsg?(c(),C(ie,{key:0,type:"error"},{default:L(()=>[oe(B(n(o).errorMsg),1)]),_:1})):F("",!0),p(Se,{"hide-on-leave":""},{default:L(()=>{var m;return[(c(),C($e((m=n(o).currentStep)==null?void 0:m.component),{ref_key:"stepComponent",ref:e},null,512))]}),_:1}),g("div",gt,[((u=e.value)==null?void 0:u.prevBtn)!==!1&&n(o).currentStepNumber!==0?(c(),C(R,{key:0,variant:"text",text:l.value,onClick:t},null,8,["text"])):F("",!0),((f=e.value)==null?void 0:f.nextBtn)!==!1?(c(),C(R,{key:1,variant:"primary",text:i.value,onClick:a},null,8,["text"])):F("",!0)]),g("div",ht,[(c(!0),h(A,null,H(n(P).steps.length,m=>(c(),h("div",{key:m,class:Ue({"install-view-footer-dot":!0,"install-view-footer-dot-active":n(o).currentStepNumber===m-1})},null,2))),128))])],64))]),yt]))}}});const qt=k(wt,[["__scopeId","data-v-be1a25ad"]]);export{qt as default};
